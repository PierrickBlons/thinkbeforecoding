<p>I’ve been posting a <a href="http://code.thinkbeforecoding.com/smtplistener" target="_blank">sample SmtpListener on my repository</a> a few days ago.</p>  <p>It’s infrastructure stuff.. what does it have to do with what I’m usually talking about here ?</p>  <p>&#160;</p>  <p><strong>It’s about Reactive Programming.</strong></p>  <p>&#160;</p>  <p>Sometimes you have to integrate with legacy systems that’ll send you things through email.</p>  <p>Ok, I know, it kind of sucks as an integration mechanism, but still… you have to do this way.</p>  <p>&#160;</p>  <p>The usual way to receive email in an application is to set a mailbox on a mail server (think Exchange), and pull mailboxes periodically to see if there’s something new there.</p>  <p>&#160;</p>  <p>There are two bad things here :</p>  <ul>   <li>People tend to use their enterprise mail server for this. The mail sever is often vital for your business and screwing it up with a bug can have a big impact on your organization.</li>    <li>Email are pushed to you.. why would you pull it. You can push it directly on your service bus !</li> </ul>  <p>So, I prototyped a small smtp listener that could easily be integrated with whatever you want.</p>  <p>&#160;</p>  <p>You need to add a MX entry in your dns zone configuration so that other servers find it, and get a valid certificate if you want to use secured TLS connections (I’ve disabled certificated verification for demo purpose).</p>  <p>&#160;</p>  <p>But as you can see, the code is very simple since the .Net framework has already what’s needed.</p>  <p>&#160;</p>  <p>The TcpListener is used to receive connections that’ll provide a TcpClient with underlying streams.</p>  <p>The SslStream class is used to encapsulate tcp streams to add Ssl encryption.</p>  <p>I’m using the reactive framework to convert the Begin/EndAcceptTcpClient methods to an Observable to avoid writing the accept loop myself.</p>  <p>&#160;</p>  <p>Then implementation of the protocol is very easy, you can find <a href="http://en.wikipedia.org/wiki/Simple_Mail_Transfer_Protocol" target="_blank">an overview and sample on wikipedia</a>.</p>  <p>The RFCs can easily be found :</p>  <p><a href="http://tools.ietf.org/rfc/rfc5321.txt">RFC 5321</a>: Simple Mail Transfer Protocol</p>  <p><a href="http://tools.ietf.org/rfc/rfc3207.txt">RFC 3207</a>: SMTP Service Extension for Secure SMTP over Transport Layer Security</p>  <p>&#160;</p>  <p>Of course you can use it freely, and propose changes to make it better since it’s not attack proof.</p>  <p>This code is not resistant to known potential SMTP attacks, including dangling connections, long lines etc.. </p>