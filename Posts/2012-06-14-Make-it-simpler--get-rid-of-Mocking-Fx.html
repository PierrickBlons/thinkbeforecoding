<p>In the wake of Rinat <a href="http://abdullin.com/journal/2012/6/8/technology-demons.html" target="_blank">Technology Demons</a>, I’d add Mocking frameworks to the list.</p>  <p>&#160;</p>  <p>There are several reasons to do that.</p>  <p>&#160;</p>  <h3>Stubs</h3>  <p>One of the usage of Mocking - or isolation – frameworks is stubbing. A component that access external resources or has complex behavior will be changed for a fake to have simpler predictable results.</p>  <p>&#160;</p>  <ul>   <li>When the component interface is small, the stub declaration code is often more complicated that writing a fake implementation directly. </li>    <li>When the interface has many methods, it makes things easier, but here you’ll ignore a code smell. It makes things easy in situation you should not reach ! </li> </ul>  <p>There are also easy patterns that make the use of mocking irrelevant. A common one is configuration loading.</p>  <p>Lots of developers think: “I need a class to access my configuration. Let’s make a class for this”:</p>  <p>&#160;</p>  <div style="font-family: Consolas; font-size: 10pt; color: black; background: white;"> <p style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">public</span> <span style="color: blue;">class</span> <span style="color: #2b91af;">Configuration</span></p> <p style="margin: 0px;">&nbsp;&nbsp;&nbsp; {</p> <p style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">public</span> <span style="color: blue;">string</span> EndPoint</p> <p style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</p> <p style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">get</span> { <span style="color: blue;">return</span> <span style="color: #2b91af;">ConfigurationManager</span>.AppSettings[<span style="color: #a31515;">&quot;EndPoint&quot;</span>]; }</p> <p style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: green;">// other properties here//</span></p> <p style="margin: 0px;">&nbsp;&nbsp;&nbsp; }</p> </div>   <p>&#160;</p>  <p>Then they realize they’ll have to isolate from ConfigurationManager, so they add a interface :</p>  <p>&#160;</p>  <p>&#160;</p>  <div style="font-family: Consolas; font-size: 10pt; color: black; background: white;"> <p style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">public</span> <span style="color: blue;">interface</span> <span style="color: #2b91af;">IConfiguration</span></p> <p style="margin: 0px;">&nbsp;&nbsp;&nbsp; {</p> <p style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">string</span> EndPoint { <span style="color: blue;">get</span>; }</p> <p style="margin: 0px;">&nbsp;&nbsp;&nbsp; }</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">public</span> <span style="color: blue;">class</span> <span style="color: #2b91af;">Configuration</span> : <span style="color: #2b91af;">IConfiguration</span></p> <p style="margin: 0px;">&nbsp;&nbsp;&nbsp; {</p> <p style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">public</span> <span style="color: blue;">string</span> EndPoint</p> <p style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</p> <p style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">get</span> { <span style="color: blue;">return</span> <span style="color: #2b91af;">ConfigurationManager</span>.AppSettings[<span style="color: #a31515;">&quot;EndPoint&quot;</span>]; }</p> <p style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: green;">// other properties here//</span></p> <p style="margin: 0px;">&nbsp;&nbsp;&nbsp; }</p> </div>   <p>And they can moke the configuration using a lot of boring code.</p>  <p>&#160;</p>  <p>what about this ?</p>  <p>&#160;</p>  <p>&#160;</p>  <div style="font-family: Consolas; font-size: 10pt; color: black; background: white;"> <p style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">public</span> <span style="color: blue;">class</span> <span style="color: #2b91af;">Configuration</span></p> <p style="margin: 0px;">&nbsp;&nbsp;&nbsp; {</p> <p style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">public</span> <span style="color: blue;">string</span> EndPoint { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }</p> <p style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: green;">// other properties here//</span></p> <p style="margin: 0px;">&nbsp;&nbsp;&nbsp; }</p> <p style="margin: 0px;">&nbsp;</p> <p style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">public</span> <span style="color: blue;">class</span> <span style="color: #2b91af;">ConfigurationLoader</span></p> <p style="margin: 0px;">&nbsp;&nbsp;&nbsp; {</p> <p style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">public</span> <span style="color: #2b91af;">Configuration</span> Load()</p> <p style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</p> <p style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">return</span> <span style="color: blue;">new</span> <span style="color: #2b91af;">Configuration</span></p> <p style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</p> <p style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; EndPoint = <span style="color: #2b91af;">ConfigurationManager</span>.AppSettings[<span style="color: #a31515;">&quot;EndPoint&quot;</span>]</p> <p style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: green;">// other properties here//</span></p> <p style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; };</p> <p style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</p> <p style="margin: 0px;">&nbsp;&nbsp;&nbsp; }</p> </div>   <p>&#160;</p>  <p>Passing a different configuration in your test is a simple <font face="Consolas">new Configuration {}</font>… and you can use the <font face="Consolas">ConfigurationLoader</font> class in you main function.</p>  <p>&#160;</p>  <p>A good thing here, is that you don’t suffer a read of the configuration file at each call without needing to introduce lazy loading or other tweaks that make things worse..</p>  <p>&#160;</p>  <h3>Mocks</h3>  <p>When you need to see if a call happened, you can make an implementation of the interface that takes a lambda :</p>  <p>&#160;</p>  <div style="font-family: consolas; background: white; color: black; font-size: 10pt">   <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">interface</span> <span style="color: #2b91af">IFancyService</span></p>    <p style="margin: 0px">&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">void</span> DoSomething(<span style="color: blue">int</span> arg);</p>    <p style="margin: 0px">&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">class</span> <span style="color: #2b91af">MockFancyService</span> : <span style="color: #2b91af">IFancyService</span></p>    <p style="margin: 0px">&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">private</span> <span style="color: #2b91af">Action</span>&lt;<span style="color: blue">int</span>&gt; doSomething;</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">public</span> MockFancyService(<span style="color: #2b91af">Action</span>&lt;<span style="color: blue">int</span>&gt; doSomething)</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">this</span>.doSomething = doSomething;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">void</span> DoSomething(<span style="color: blue">int</span> arg)</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; doSomething(arg);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">class</span> <span style="color: #2b91af">Test</span></p>    <p style="margin: 0px">&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">void</span> DoSomthingHasBenCalled()</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">bool</span> wasCalled = <span style="color: blue">false</span>;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> fancyService = <span style="color: blue">new</span> <span style="color: #2b91af">MockFancyService</span>(i =&gt; { wasCalled = <span style="color: blue">true</span>; });</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">var</span> compoenent = <span style="color: blue">new</span> <span style="color: #2b91af">ComponentThatUseFancyService</span>(fancyService);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; compoenent.MakeSomething();</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: #2b91af">Assert</span>.That(wasCalled, <span style="color: #2b91af">Is</span>.True);</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;&#160;&#160; }</p> </div>  <p>Or make the fake class record the call, and add a getter to check. It’s not that complicated.</p>